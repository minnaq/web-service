{"version":3,"sources":["../../source/middleware/acl.js"],"names":["access_list","ip_access_list","ctx","next","request","ips","concat","req","connection","remoteAddress","ip_address","test","Error"],"mappings":";;;;;;;;;;;;;;;;;;kBAEe,UAASA,WAAT,EACf;AACC;AACA;AACA,KAAMC,iBAAiB,kBAAgBD,WAAhB,CAAvB;;AAEA;AAAA,wEAAO,iBAAeE,GAAf,EAAoBC,IAApB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAEN;AACA;AAHM;AAAA;AAAA;AAAA;AAAA,8CAIiBD,IAAIE,OAAJ,CAAYC,GAAZ,CAAgBC,MAAhB,CAAuBJ,IAAIK,GAAJ,CAAQC,UAAR,CAAmBC,aAA1C,CAJjB;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAIGC,iBAJH;;AAAA,WAMAT,eAAeU,IAAf,CAAoBD,UAApB,CANA;AAAA;AAAA;AAAA;;AAAA,aAQE,IAAIE,KAAJ,2BAAkCF,UAAlC,CARF;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA,cAYAP,MAZA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAP;;AAAA;AAAA;AAAA;AAAA;AAcA,C;;AAtBD","file":"acl.js","sourcesContent":["import Access_list from '../acl'\n\nexport default function(access_list)\n{\n\t// If an Access Control List is set,\n\t// then allow only IPs from the list of subnets.\n\tconst ip_access_list = new Access_list(access_list)\n\n\treturn async function(ctx, next)\n\t{\n\t\t// Check the entire `X-Forwarded-For` IP address chain\n\t\t// along with the HTTP request originator IP address.\n\t\tfor (let ip_address of ctx.request.ips.concat(ctx.req.connection.remoteAddress))\n\t\t{\n\t\t\tif (!ip_access_list.test(ip_address))\n\t\t\t{\n\t\t\t\tthrow new Error(`Access denied for ip ${ip_address}`)\n\t\t\t}\n\t\t}\n\n\t\tawait next()\n\t}\n}"]}